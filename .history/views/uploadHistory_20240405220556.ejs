<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload History</title>
    <link rel="stylesheet" href="/styles/history.css">
</head>
<body>
    <div class="container">
        <h1>Upload History</h1>
        <% if (history.length > 0) { %>
            <div class="history-list">
                <% history.forEach(item => { %>
                    <button class="history-item" data-pdf="<%= item.Pdf_path %>" data-xlsx="<%= item.xlsx_path %>">
                        <%= new Date(item.timestamp).toLocaleString() %>
                    </button>
                <% }); %>
            </div>
        <% } else { %>
            <p class="no-history">No upload history available.</p>
        <% } %>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const historyItems = document.querySelectorAll('.history-item');
        
            historyItems.forEach(item => {
                item.addEventListener('click', function() {
                    const pdfPath = this.getAttribute('data-pdf');
                    const xlsxPath = this.getAttribute('data-xlsx');
        
                    // View PDF
                    const viewPdfForm = document.createElement('form');
                    viewPdfForm.method = 'POST';
                    viewPdfForm.action = '/viewFile';
                    viewPdfForm.target = '_blank';
        
                    const pdfInput = document.createElement('input');
                    pdfInput.type = 'hidden';
                    pdfInput.name = 'filePath';
                    pdfInput.value = pdfPath;
        
                    viewPdfForm.appendChild(pdfInput);
                    document.body.appendChild(viewPdfForm); // Append form to document body
                    viewPdfForm.submit();
        
                    // Download PDF
                    const downloadPdfForm = document.createElement('form');
                    downloadPdfForm.method = 'POST';
                    downloadPdfForm.action = '/downloadFile';
        
                    const pdfDownloadInput = document.createElement('input');
                    pdfDownloadInput.type = 'hidden';
                    pdfDownloadInput.name = 'filePath';
                    pdfDownloadInput.value = pdfPath;
        
                    downloadPdfForm.appendChild(pdfDownloadInput);
                    document.body.appendChild(downloadPdfForm); // Append form to document body
                    downloadPdfForm.submit();
        
                    // View XLSX
                    const viewXlsxForm = document.createElement('form');
                    viewXlsxForm.method = 'POST';
                    viewXlsxForm.action = '/viewFile';
                    viewXlsxForm.target = '_blank';
        
                    const xlsxInput = document.createElement('input');
                    xlsxInput.type = 'hidden';
                    xlsxInput.name = 'filePath';
                    xlsxInput.value = xlsxPath;
        
                    viewXlsxForm.appendChild(xlsxInput);
                    document.body.appendChild(viewXlsxForm); // Append form to document body
                    viewXlsxForm.submit();
        
                    // Download XLSX
                    const downloadXlsxForm = document.createElement('form');
                    downloadXlsxForm.method = 'POST';
                    downloadXlsxForm.action = '/downloadFile';
        
                    const xlsxDownloadInput = document.createElement('input');
                    xlsxDownloadInput.type = 'hidden';
                    xlsxDownloadInput.name = 'filePath';
                    xlsxDownloadInput.value = xlsxPath;
        
                    downloadXlsxForm.appendChild(xlsxDownloadInput);
                    document.body.appendChild(downloadXlsxForm); // Append form to document body
                    downloadXlsxForm.submit();
                });
            });
        });       
    </script>
</body>
</html>
