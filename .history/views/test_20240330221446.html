<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
</head>
<body>
    <h1>PDF Generator</h1>
    <form id="pdfForm">
        <label for="input1">Input 1:</label>
        <input type="text" id="input1" name="input1"><br><br>
        <label for="input2">Input 2:</label>
        <input type="text" id="input2" name="input2"><br><br>
        <label for="input3">Input 3:</label>
        <input type="text" id="input3" name="input3"><br><br>
        <input type="file" id="pdfFile" name="pdfFile"><br><br>
        <button type="submit">Generate PDF</button>
    </form>

    <div id="pdfViewer">
        <canvas id="pdfCanvas"></canvas>
    </div>

    <script>
        document.getElementById('pdfForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData();
            formData.append('input1', document.getElementById('input1').value);
            formData.append('input2', document.getElementById('input2').value);
            formData.append('input3', document.getElementById('input3').value);
            formData.append('pdfFile', document.getElementById('pdfFile').files[0]);

            fetch('/generate-pdf', {
                method: 'POST',
                body: formData
            })
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'generated.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => console.error('Error generating PDF:', error));
        });

        // PDF.js code to display PDF and capture click events
        const pdfViewer = document.getElementById('pdfViewer');
        const canvas = document.getElementById('pdfCanvas');
        const ctx = canvas.getContext('2d');
        let pdfData;

        const pdfFileInput = document.getElementById('pdfFile');

        pdfFileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            const fileReader = new FileReader();

            fileReader.onload = function() {
                pdfData = new Uint8Array(this.result);
                displayPdf(pdfData);
            };

            fileReader.readAsArrayBuffer(file);
        });

        function displayPdf(pdfData) {
            PDFJS.getDocument(pdfData).promise.then(function(pdf) {
                pdf.getPage(1).then(function(page) {
                    const viewport = page.getViewport({ scale: 1 });
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    const renderContext = {
                        canvasContext: ctx,
                        viewport: viewport
                    };

                    page.render(renderContext);

                    canvas.addEventListener('click', function(event) {
                        const rect = canvas.getBoundingClientRect();
                        const scaleX = canvas.width / rect.width;
                        const scaleY = canvas.height / rect.height;
                        const x = (event.clientX - rect.left) * scaleX;
                        const y = (event.clientY - rect.top) * scaleY;

                        const formData = new FormData();
                        formData.append('x', x);
                        formData.append('y', y);

                        console.log('Clicked coordinates:', { x, y });

                        // Here you can send the coordinates to the backend
                        // For simplicity, I'm just logging them
                    });
                });
            });
        }
    </script>
</body>
</html>
